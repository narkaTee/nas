---
- name: Run role
  hosts: all
  any_errors_fatal: true
  vars:
    debian_backports_enabled: false
  tasks:
    - name: Determine expected backports file path for Debian >= 13
      set_fact:
        debian_backports_expected_backports_file: "/etc/apt/sources.list.d/backports.sources"
      when: (ansible_facts['distribution_major_version'] | int) >= 13

    - name: Determine expected backports file path for Debian < 13
      set_fact:
        debian_backports_expected_backports_file: "/etc/apt/sources.list.d/backports.list"
      when: (ansible_facts['distribution_major_version'] | int) < 13

    - name: Create dummy file to test removal
      ansible.builtin.copy:
        dest: "{{ debian_backports_expected_backports_file }}"
        content: "# dummy file to be removed"
        mode: '0644'

    - name: "Include debian_backports role"
      ansible.builtin.include_role:
        name: "../../../debian_backports"
